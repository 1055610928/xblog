---
title: 7. 位运算
urlname: elrq17
date: '2021-08-01 09:12:55 +0800'
tags: []
categories: []
---

- 运算符
  - `+`,  `-`,  `*` ,  `/` ,  `&&`,  `||`   等等
- 例子

  - 权限系统
    - 三种权限： 读取， 写入， 删除
    - 管理员：
      - 读取， 写入， 删除
    - 用户：
      - 读取
  - 如果单纯 js 代码就会写出很多 if 逻辑

- 代码例子

```javascript
// 二进制
// 读取权限
const readPermission = 1; // 2^0
// 写入权限
const writePermission = 2; // 2^1
// 删除权限
const deletePermission = 4; // 2^2

// 我的权限
// 0 代表没有任何权限
let myPermission = 0;
// 加上读取权限
myPermission = myPermission | readPermission;

// 要检查我有没有读取的权限
let message = myPermission & readPermission ? "yes" : "no";
console.log(message); // yes

// 要检查我有没有删除权限
console.log(myPermission & deletePermission ? "yes" : "no"); // no
console.log(myPermission & writePermission ? "yes" : "no"); // no
```

- 进制

```javascript
// 123456789 --> 10进制
// 1 (10进制) --> 00000001 (2进制) 2^0 * 1
// 2 (10进制) --> 00000010 (2进制) 2^1 * 1 = 2
// 4 (10进制) --> 00000100 (2进制) 2 ^ 2 * 1 = 4
```

- 计算机当中存储的信息单位
- 比特和字节

  - 比特 bit
    - 00000001   比特
  - 二进制的特点
    - 0 和 1
  - 字节   byte
    - 1 个字节 = 8 个 bit
    - 00000001
  - 1kb
    - 1024 byte
  - 1mb
    - 1024kb
  - 1GB
    - 1024mb

- 机器数

  - 整数在计算机中存储的方式
    - 整数在计算机中是以二进制表示的
    - 第一位为符号位
      - 0 位正， 1 为负
    - `10`  ------>  01010  ----> 1* 2^3 + 1 * 2^1 = 10
    - `-10` ------>  11010
  - 机器数的三种形式 - 正数： 原码，反码，补码，都是一样的 - 负数： - 原码的第 1 位为 1，表示负数 - 转换成反码的时候符号位不变，后面取反 - 补码是反码加一
    | 整数 | 原码 | 反码 | 补码 |
    | --- | --- | --- | --- |
    | 1 | 00000001 | 00000001 | 00000001 |
    | -1 | 10000001 | 11111110 | 11111111 |
    | 5 | 00000101 | 00000101 | 00000101 |
    | -5 | 10000101 | 11111010 | 11111011 |

- 例子：

```javascript
// +1 - 1  看成  (+1) + (-1)

// js表示数字的时候是以 32位表示
// 二进制：逢二进一
// 都是看补码
// 1  00000000000000000000000000000001
// -1 11111111111111111111111111111111
// 		00000000000000000000000000000000
// 结果就是：0
```

- 按位与 ( & ) 对每一位进行 AND 的操作
  - 规则

```javascript
0 & 0 = 0
0 & 1 = 0
1 & 0 = 0
1 & 1 = 1
```

- 例子：

```javascript
9 & 14
// 9 (10进制) = 0000000000000000000000000001001 (二进制)
// 14 (10进制) = 0000000000000000000000000001110 (二进制)
-------------------------------------
0000000000000000000000000001000 = 8 // (10进制)
```

```javascript
9 & -1
// 9 (10进制) = 0000000000000000000000000001001 (二进制)
// -1 (10进制) = 1111111111111111111111111111111 (二进制)
-------------------------------------
0000000000000000000000000001001 = 9 // (10进制)
```

- 总结： - 任意的数值 x 与 0 执行 按位与操作的时候，结果都是 0 - 任意的数值 x 与 -1 执行按位与操作的时候，结果都是 x

- 实际使用
  - 判断奇偶
    - 奇数的特性：最后一位为 1

```javascript
// 1 (10进制) = 0000000000000000000000000000001 (二进制)
// 3 (10进制) = 0000000000000000000000000000011 (二进制)
// 4 (10进制) = 0000000000000000000000000000100 (二进制)
// 5 (10进制) = 00000000000000000000000000000101 (二进制)
// 7 (10进制) = 0000000000000000000000000000111 (二进制)
// 9 (10进制) = 0000000000000000000000000001001 (二进制)
```

```javascript
// 3 & 1
// 0000000000000000000000000000011
// 0000000000000000000000000000001
------------------------------------
// 0000000000000000000000000000001
```

```javascript
// 更接近底层，计算速度更加快
function isOdd(number) {
  // console.log(number & 1)
  return (number & 1) === 1;
}
console.log(isOdd(9));
```

- 按位或
  - 对每一位 or 的操作
    - 任何数值 x 与 0 执行按位或操作的时候，结果都是 x
    - 任何数值 x 与 -1 执行按位或操作的时候，结果都是 -1

```javascript
// 0|0 = 0   0|1 = 1   1|0 = 1  1|1 = 1

// 9 | 14
// 0000000000000000000000000001001
// 0000000000000000000000000001110
-------------------------------------
// 0000000000000000000000000001111 = 15

// 9 | 0
// 0000000000000000000000000001001
// 0000000000000000000000000000000
-----------------------------------
// 0000000000000000000000000001001 = 15


// 9|-1
// 0000000000000000000000000001001
// 1111111111111111111111111111111
// --------------------------------
// 1111111111111111111111111111111 = -1
```

- 按位或的例子
  - 按位或可以做权限的管理

```javascript
// 二进制
// 读取权限
const readPermission = 1; // 2^0
// 写入权限
const writePermission = 2; // 2^1
// 删除权限
const deletePermission = 4; // 2^2

// 我的权限
// 0 代表没有任何权限
let myPermission = 0;
// 加上读取权限
myPermission = myPermission | readPermission;

// 要检查我有没有读取的权限
let message = myPermission & readPermission ? "yes" : "no";
console.log(message); // yes

// 要检查我有没有删除权限
console.log(myPermission & deletePermission ? "yes" : "no"); // no
console.log(myPermission & writePermission ? "yes" : "no"); // no
```

```javascript
const result = 0 | 1 | 2;
// result = 3
// 3 & 1
// 0011 & 0001 = 1

// 3&4
// 0011 & 0100 = 0
```

- 按位异或
  - 对每一位进行异或操作(XOR)
    - 任何数值 x 与 0 执行按位或操作的时候，结果都是 x
    - 任何数值 x 与 -1 执行按位或操作的时候，结果都是 -(x+1)

```javascript
// --- 以下可以看成两者相加 ---
// 0^0 = 0
// 0^1 = 1
// 1^0 = 1
// 1^1 = 0

// 9 (10进制) = 0000000000000000000000000001001
// 14 (10进制) = 0000000000000000000000000001110
------------------------------------
0000000000000000000000000000111  // 7
```

- 切换变量的值 0^1
  - 交换两个变量的值

```javascript
let a = 1;
let b = 10;
// a = 10, b = 1
a = a ^ b;
b = a ^ b;
a = a ^ b;

// a = a ^ b = 1
// b = a ^ b =
```

- 按位非 (~)
  - 对每一位进行 not 的操作
    - 总结： `-(x+1)`

```javascript
// 9~9
9 = 1001
~9 =0110 = (-10)
```

- 实际应用 - `~-1 = 0`

```javascript
// str.indexOf(seachIndex)
// 和 indexOf一起使用

var str = "boy";
const seachFor = "b";
if (~str.indexOf(searchFor)) {
  // 包含
} else {
  // 不包含
}
```

- 按位移动操作符
  - << 左移
    - 总结
      - 数字 x 左移 n 位，得到 x \* 2^n
      - 9 \* 2^2 = 36

```javascript
// 9 << 2
// 0110
// 100100
```

- 实际应用
- rgb 颜色 转换成 16 进制颜色
- rgb(255, 255, 255)   #ffffff
- 16 进制  --->  10 进制
  - ff = 15 \_ 16^1 + 15_16^0 = 255

```javascript
ff0000  0000ff << 4  0000ff * 16 ^4
00ff00  0000ff << 2  0000ff * 16^2
0000ff  0000ff
```

- rgb 转 16 进制

```javascript
function RGBtoHex(rgb) {
  let arr = rgb.match(/\d+/g);
  let hex = ((arr[0] << 16) | (arr[1] << 8) | arr[2]).toString(16);
  return `#${hex}`;
}

let color = `rgb(0,255,255)`;
let res = RGBtoHex(color);
console.log(res);
```

- 有符号右移
  - `>>`
    - 数字 x 右移 n 位
    - 8 / 2^2 = 2
    - 会精度丢失

```javascript
// 8 >> 2
// 1000
// 0010
// 2
```
